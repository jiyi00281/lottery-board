<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>波场极速彩 - 智能预测看板</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="mb-3">波场极速彩 - 智能预测看板</h2>

    <div class="alert alert-success" id="status">数据更新成功</div>

    <div class="p-4 mb-3 bg-info text-white rounded">
      <p><strong>预测数字：</strong><span id="predict-number">--</span></p>
      <p><strong>命中率估算：</strong><span id="hit-rate">--%</span></p>
      <p><strong>使用模型：</strong><span id="model">--</span></p>
      <p><strong>分析说明：</strong><span id="analysis">--</span></p>
    </div>

    <p><strong>最后开奖时间：</strong><span id="last-time">--</span></p>

    <h5 class="mt-4">预测命中记录</h5>
    <ul id="hit-list" class="list-group mb-4"></ul>

    <h5>开奖记录</h5>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>期号</th>
          <th>开奖号码</th>
          <th>开奖时间</th>
        </tr>
      </thead>
      <tbody id="history-table"></tbody>
    </table>
  </div>

  <script>
    const API_URL = 'https://api.duoqu.online/data?code=Tron-Fast&limit=30&key=rkjpugmlzj';
    let history = [];
    let hits = [];

    function simulatedAnnealing(numbers) {
      let freq = {};
      numbers.flat().forEach(n => freq[n] = (freq[n] || 0) + 1);
      let sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
      return parseInt(sorted[0][0]); // 返回最频繁数字
    }

    function updateDisplay(data) {
      const latest = data[0];
      document.getElementById("last-time").innerText = latest.openTime;

      const numbers = data.map(item => item.openNumber.split(',').map(n => parseInt(n)));
      const predict = simulatedAnnealing(numbers);
      const currentBet = latest.betNo;

      const existed = hits.find(h => h.betNo === currentBet);
      if (!existed) {
        const hit = numbers[0].includes(predict);
        hits.unshift({
          betNo: currentBet,
          number: predict,
          hit: hit
        });
        if (hits.length > 10) hits.pop();
      }

      document.getElementById("predict-number").innerText = predict;
      document.getElementById("hit-rate").innerText = (hits.filter(h => h.hit).length / hits.length * 100).toFixed(2) + "%";
      document.getElementById("model").innerText = "退火 + 概率模型";
      document.getElementById("analysis").innerText = "近期数字频率退火优化选出";

      let hitHTML = "";
      hits.forEach(h => {
        hitHTML += `<li class="list-group-item">
          预测期号 ${h.betNo} - 数字 ${h.number} - <span style="color:${h.hit ? 'green' : 'red'}">${h.hit ? '命中' : '未中'}</span>
        </li>`;
      });
      document.getElementById("hit-list").innerHTML = hitHTML;

      let tableHTML = "";
      data.slice(0, 20).forEach(item => {
        tableHTML += `<tr><td>${item.betNo}</td><td>${item.openNumber}</td><td>${item.openTime}</td></tr>`;
      });
      document.getElementById("history-table").innerHTML = tableHTML;
    }

    async function fetchData() {
      try {
        const res = await fetch(API_URL);
        const json = await res.json();
        if (json.data) {
          updateDisplay(json.data);
          document.getElementById("status").innerText = "数据更新成功";
        } else {
          document.getElementById("status").innerText = "接口返回失败";
        }
      } catch (e) {
        document.getElementById("status").innerText = "拉取失败：" + e.message;
      }
    }

    fetchData();
    setInterval(fetchData, 3000); // 每3秒刷新
  </script>
</body>
</html>
