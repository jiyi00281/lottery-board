<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>波场极速彩 - 智能预测看板</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; margin: 0; background: #f8f8f8; }
    .box { background: #fff; padding: 20px; margin: 20px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    .success { background: #dff0d8; color: #3c763d; padding: 10px; margin-bottom: 15px; }
    .predict-box { background: #d9f7fc; padding: 20px; border-radius: 4px; }
    .highlight { color: #d00; font-weight: bold; }
    .table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .table th, .table td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    .hit { color: green; }
    .miss { color: red; }
  </style>
</head>
<body>
  <div class="box">
    <div class="success" id="status">数据更新成功</div>
    <div class="predict-box">
      <p><strong>预测数字：</strong><span id="predict-number">-</span></p>
      <p><strong>命中率估算：</strong><span id="accuracy">--%</span></p>
      <p><strong>使用模型：</strong><span id="model-type">--</span></p>
      <p><strong>分析说明：</strong><span id="analysis">--</span></p>
    </div>
    <p>最后开奖时间：<span id="last-time">--</span></p>
  </div>

  <div class="box">
    <h3>预测命中记录</h3>
    <ul id="history"></ul>
  </div>

  <div class="box">
    <h3>开奖记录</h3>
    <table class="table" id="result-table">
      <thead><tr><th>期号</th><th>开奖号码</th><th>开奖时间</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API = 'https://corsproxy.io/?https://api1.duoqu.online/data?code=Tron-Fast&limit=30&key=rkjpugmlzj';
    const INTERVAL = 3000;
    let history = [];

    function predictSmart(data) {
      const counts = {};
      data.forEach(d => d.openNumber.split(',').forEach(n => counts[n] = (counts[n] || 0) + 1));
      const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
      const top = sorted.slice(0, 3).map(i => i[0]);
      return {
        number: top[0],
        model: "概率加权模型",
        analysis: "频率模型得分更稳定"
      };
    }

    async function load() {
      try {
        const res = await fetch(API);
        const json = await res.json();
        const list = json.data;
        const now = new Date();
        const last = list[0];
        document.getElementById('last-time').textContent = last.openTime;

        // 填表格
        const tbody = document.querySelector("#result-table tbody");
        tbody.innerHTML = '';
        list.forEach(item => {
          const tr = `<tr><td>${item.betNo}</td><td>${item.openNumber}</td><td>${item.openTime}</td></tr>`;
          tbody.innerHTML += tr;
        });

        // 预测
        const predict = predictSmart(list);
        document.getElementById('predict-number').textContent = predict.number;
        document.getElementById('model-type').textContent = predict.model;
        document.getElementById('analysis').textContent = predict.analysis;

        // 命中统计
        const lastDraw = list[0];
        const lastNumbers = lastDraw.openNumber.split(',');
        const isHit = lastNumbers.includes(predict.number);
        history.unshift({
          number: predict.number,
          betNo: lastDraw.betNo,
          hit: isHit
        });
        if (history.length > 20) history.pop();

        const acc = (history.filter(i => i.hit).length / history.length * 100).toFixed(2);
        document.getElementById('accuracy').textContent = acc + '%';

        const ul = document.getElementById('history');
        ul.innerHTML = '';
        history.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `预测期号 ${item.betNo} - 数字 ${item.number} - <span class="${item.hit ? 'hit' : 'miss'}">${item.hit ? '命中' : '未中'}</span>`;
          ul.appendChild(li);
        });
      } catch (e) {
        document.getElementById('status').textContent = '更新失败，请稍后重试';
      }
    }

    load();
    setInterval(load, INTERVAL);
  </script>
</body>
</html>
