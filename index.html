 <!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>波场极速彩 - 预测看板 (GitHub Pages版)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4">波场极速彩 - 预测看板</h2>

  <div id="api-status" class="alert alert-secondary">接口状态：初始化中...</div>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>期号</th>
        <th>开奖号码</th>
        <th>开奖时间</th>
      </tr>
    </thead>
    <tbody id="lottery-table-body">
      <tr><td colspan="3" class="text-center">加载中...</td></tr>
    </tbody>
  </table>
  <p class="text-muted" id="last-updated">最后更新：--</p>

  <h4 class="mt-5">下一期预测</h4>
  <div class="alert alert-info">
    <strong>预测下期必出数字：</strong> <span id="predicted-number">--</span><br>
    <small>理论命中率预估：<span id="predicted-accuracy">--</span>%</small>
  </div>

  <h4 class="mt-4">最近预测命中记录</h4>
  <ul id="prediction-history" class="list-group"></ul>
</div>

<script>
const API_URL = 'https://corsproxy.io/?https://api1.duoqu.online/data?code=Tron-Fast&limit=30&key=rkjpugmlzj';
const REFRESH_INTERVAL = 10000;

let predictionHistory = [];

function simulatedAnnealing(counts) {
  let current = Math.floor(Math.random() * 10);
  let score = counts[current];
  let temp = 100, cooling = 0.95, minTemp = 0.1;

  function neighbor(sol) {
    let n;
    do { n = Math.floor(Math.random() * 10); } while (n === sol);
    return n;
  }

  while (temp > minTemp) {
    const next = neighbor(current);
    const delta = counts[next] - score;
    if (delta > 0 || Math.exp(delta / temp) > Math.random()) {
      current = next;
      score = counts[next];
    }
    temp *= cooling;
  }

  return current;
}

function fetchLotteryData() {
  fetch(API_URL)
    .then(response => response.json())
    .then(json => {
      if (json.info !== "success") throw new Error("接口返回错误");

      document.getElementById("api-status").className = "alert alert-success";
      document.getElementById("api-status").textContent = "接口状态：连接成功";

      const data = json.data.reverse();
      const tbody = document.getElementById("lottery-table-body");
      tbody.innerHTML = "";
      let allDigits = [];

      data.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.betNo}</td>
          <td>${item.openNumber}</td>
          <td>${item.openTime}</td>
        `;
        tbody.appendChild(tr);

        item.openNumber.split(',').forEach(num => allDigits.push(parseInt(num)));
      });

      // 理论命中率统计
      let counts = Array(10).fill(0);
      allDigits.forEach(num => counts[num]++);

      let total = allDigits.length;
      let probabilities = counts.map(c => c / total);
      let predictedNumber = simulatedAnnealing(counts);

      // 命中判断
      const lastBet = data[data.length - 1];
      const lastNumbers = lastBet.openNumber.split(',').map(n => parseInt(n));
      const hit = lastNumbers.includes(predictedNumber);

      predictionHistory.unshift({
        betNo: lastBet.betNo,
        predicted: predictedNumber,
        hit: hit,
        accuracy: (probabilities[predictedNumber] * 100).toFixed(2)
      });
      if (predictionHistory.length > 10) predictionHistory.pop();

      document.getElementById("predicted-number").textContent = predictedNumber;
      document.getElementById("predicted-accuracy").textContent = (probabilities[predictedNumber] * 100).toFixed(2);

      document.getElementById("last-updated").textContent = "最后更新：" + new Date().toLocaleString();

      const historyList = document.getElementById("prediction-history");
      historyList.innerHTML = "";
      predictionHistory.forEach(p => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between";
        li.innerHTML = `
          <span>预测期号：${p.betNo} - 数字 ${p.predicted} (命中率 ${p.accuracy}%)</span>
          <span class="badge bg-${p.hit ? "success" : "danger"}">${p.hit ? "命中" : "未中"}</span>
        `;
        historyList.appendChild(li);
      });

    })
    .catch(err => {
      document.getElementById("api-status").className = "alert alert-danger";
      document.getElementById("api-status").textContent = "接口状态：请求失败";
      console.error(err);
    });
}

fetchLotteryData();
setInterval(fetchLotteryData, REFRESH_INTERVAL);
</script>
</body>
</html>
