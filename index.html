<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>波场极速彩 - 智能预测看板</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-4">
        <h2 class="mb-4">波场极速彩 - 智能预测看板</h2>

        <div id="latest-time" class="mb-3 text-muted">最后开奖时间：</div>

        <div class="alert alert-success" role="alert">数据更新成功</div>

        <div class="p-3 mb-4 bg-info text-dark rounded">
            <p><strong>预测数字：</strong><span id="predicted-number">-</span></p>
            <p><strong>命中率估算：</strong><span id="prediction-accuracy">--%</span></p>
            <p><strong>使用模型：</strong><span id="model-used">--</span></p>
            <p><strong>分析说明：</strong><span id="analysis-reason">--</span></p>
        </div>

        <h4>预测命中记录</h4>
        <ul id="prediction-history" class="list-group mb-4"></ul>

        <h4>开奖记录</h4>
        <table class="table table-striped">
            <thead><tr><th>期号</th><th>开奖号码</th><th>开奖时间</th></tr></thead>
            <tbody id="history-body"></tbody>
        </table>
    </div>

    <script>
    const API_URL = 'https://api1.duoqu.online/data?code=Tron-Fast&limit=30&key=rkjpugmlzj';
    const REFRESH_INTERVAL = 3000;
    let predictionHistory = [];

    async function fetchLotteryData() {{
        try {{
            const res = await fetch(API_URL);
            const {{ data }} = await res.json();
            if (!data || !Array.isArray(data)) return;

            document.getElementById("latest-time").innerText = "最后开奖时间：" + data[0].openTime;

            const freqMap = Array(10).fill(0);
            data.forEach(item => {{
                item.openNumber.split(',').forEach(num => {{
                    freqMap[parseInt(num)]++;
                }});
            }});

            const bestByFreq = freqMap.indexOf(Math.max(...freqMap));
            const model = '概率加权模型';
            const predicted = bestByFreq;
            const explanation = '频率模型得分更稳定';

            const hitRate = getHitRate();
            updatePredictionDisplay(predicted, model, hitRate, explanation);
            compareWithLatest(data[0], predicted);
            renderHistoryTable(data);
        }} catch (e) {{
            console.error('接口请求失败', e);
        }}
    }}

    function updatePredictionDisplay(num, model, rate, reason) {{
        document.getElementById('predicted-number').innerText = num;
        document.getElementById('model-used').innerText = model;
        document.getElementById('prediction-accuracy').innerText = rate.toFixed(2) + "%";
        document.getElementById('analysis-reason').innerText = reason;
    }}

    function compareWithLatest(latestDraw, predictedNum) {{
        const numbers = latestDraw.openNumber.split(',').map(Number);
        const hit = numbers.includes(predictedNum);
        predictionHistory.unshift({{
            betNo: latestDraw.expect,
            number: predictedNum,
            hit,
        }});
        if (predictionHistory.length > 20) predictionHistory.pop();
        renderPredictionHistory();
    }}

    function renderPredictionHistory() {{
        const container = document.getElementById('prediction-history');
        container.innerHTML = '';
        predictionHistory.forEach(function(item) {{
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.innerHTML = '预测期号 ' + item.betNo + ' - 数字 ' + item.number + ' - <span class="fw-bold text-' + (item.hit ? 'success' : 'danger') + '">' + (item.hit ? '命中' : '未中') + '</span>';
            container.appendChild(li);
        }});
    }}

    function renderHistoryTable(data) {{
        const tbody = document.getElementById("history-body");
        tbody.innerHTML = '';
        data.forEach(item => {{
            const row = document.createElement('tr');
            row.innerHTML = "<td>" + item.expect + "</td><td>" + item.openNumber + "</td><td>" + item.openTime + "</td>";
            tbody.appendChild(row);
        }});
    }}

    function getHitRate() {{
        const total = predictionHistory.length || 1;
        const hits = predictionHistory.filter(item => item.hit).length;
        return (hits / total) * 100;
    }}

    fetchLotteryData();
    setInterval(fetchLotteryData, REFRESH_INTERVAL);
    </script>
</body>
</html>
