class BettingStrategy:
    def __init__(self, initial_balance=100):
        self.balance = initial_balance
        self.base_bet = 2.0
        self.win_streak = 0
        self.loss_streak = 0
        self.total_rounds = 0
        
    def calculate_bet_amount(self):
        # 动态计算下注金额
        max_bet = self.balance * 0.03
        
        if self.win_streak > 0:
            # 连续赢增加下注
            bet = self.base_bet * (1 + self.win_streak * 0.1)
        elif self.loss_streak > 0:
            # 连续输减少下注
            bet = self.base_bet * (1 - self.loss_streak * 0.15)
        else:
            bet = self.base_bet
        
        # 确保不超过最大下注限制
        return min(bet, max_bet)
    
    def determine_bet_direction(self):
        # 基于概率和连续输赢确定投注方向
        base_prob = 0.525  # 基础正向概率
        
        # 根据连续输赢调整概率
        if self.win_streak > 2:
            return "反向"
        elif self.loss_streak > 2:
            return "正向"
        
        # 随机生成方向
        import random
        return "正向" if random.random() < base_prob else "反向"
    
    def update_result(self, result, actual_bet_amount):
        self.total_rounds += 1
        
        if result == "赢":
            self.balance += actual_bet_amount
            self.win_streak += 1
            self.loss_streak = 0
        else:
            self.balance -= actual_bet_amount
            self.loss_streak += 1
            self.win_streak = 0
        
    def get_next_round_strategy(self):
        # 计算下一轮的投注策略
        bet_amount = self.calculate_bet_amount()
        bet_direction = self.determine_bet_direction()
        
        return {
            "投注金额": round(bet_amount, 2),
            "投注方向": bet_direction,
            "当前余额": round(self.balance, 2)
        }

# 使用示例
strategy = BettingStrategy()

# 第一轮
first_round = strategy.get_next_round_strategy()
print("第一轮策略:", first_round)

# 输入第一轮结果
strategy.update_result("赢", first_round["投注金额"])

# 第二轮
second_round = strategy.get_next_round_strategy()
print("第二轮策略:", second_round)
